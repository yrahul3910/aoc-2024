This problem does not lend itself to functional programming very well.
